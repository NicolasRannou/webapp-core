<polymer-element name="members-element" attributes="page nextpage previouspage route narrow full color colorinit">
  <template>
    <link rel="stylesheet" href="members.css"> 
    <div id="container1" layout horizontal fit style="background-color: {{ page.style.color }};">

      <core-animated-pages id="pages" flex selected="0" on-core-animated-pages-transition-end="{{transitionend}}" transitions="cross-fade-all hero-transition slide-up slide-down">

      <!-- loading section -->
      <section vertical layout >

              <div class="loading" fit style="min-height:100%;" flex="" horizontal="" wrap="" center="" around-justified="" layout="" slide-down cross-fade>
                 Loading the page!
              </div>

        </section>



        <section vertical layout>
<div id="noscroll" fit hero-p slide-up?="{{lastSelected === 0 }}">
            <div id="container" flex="" horizontal="" wrap="" around-justified="" layout="" cross-fade="" style="background-color: #f9f9f9;">

<div class="page" row style='color: {{ page.style.color }}; flex:1 100%'>
                <div class="block grid_outer">
                <div class='padder'>
                  <span cross-fade> Members </span>
                  </div>
                </div>
                  
              </div>

<div style="flex: 1 100%;" cross-fade>
            <div class="grid_outer" flex horizontal wrap around-justified layout cross-fade>
              <template repeat="{{item in items}}">
                <div class="card" style="background-color:{{ page.style.accent }};"vertical center center-justified layout hero-id="item-{{item}}" hero?="{{$.pages.selected === item + 2 || lastSelected === item + 2}}" on-tap="{{selectView}}"><span cross-fade>{{item}}</span></div>
              </template>
</div>
</div>
              <footer-element cross-fade id="footerYo" narrow="{{narrow}}"></footer-element>
            </div>
            </div>
          <!-- </core-scroll-header-panel> -->
        </section>

        <template repeat="{{item in items}}">
          <section vertical layout>
            <div on-tap="{{back}}" class="view" style="background-color:{{ page.style.accent }};" flex vertical center center-justified layout hero-id="item-{{item}}" hero?="{{$.pages.selected === item + 2 || $.pages.selected === 1}}"><span cross-fade>{{item}}</span></div>
          </section>
        </template>

      </core-animated-pages>

    </div>

    <google-sheets key="{{ page.key }}"  rows="{{ rows }}" published></google-sheets>

  </template>

  <script>
    Polymer('members-element', {
      items : null,
      // key : '0Asu7h0aKnydhdHN6R2lCX1N4VlZ3dnB2ZHhLWWFZQ3c',
      // response : {},
      page: {
        color: ''
      },
      rowsChanged: function(){
      window.console.log(this.rows);
      if(this.rows && this.rows.length >= 1){
        console.log(this.rows);
        // no need of this loop, template take care of it...
        this.items = [];
        for(var i = 0; i < this.rows.length; i++){
            this.items.push(i);
          }
        this.$.pages.selected = 1;
      }
    },
      routeChanged : function(){
        // not right page, exit
        if(! (this.route[0] === this.page.chapterId && this.route[1] === this.page.id )){
            return;
        }

        if(this.route.length < 3){
          // here we assume data is loaded....
          if(this.rows.length > 0){
            this.back();
          }
          else{
            this.$.pages.selected = 0;
          }
          
        }
        else{
          this.$.pages.selected = parseInt(this.route[3]) + 2;
        }
      },
      transitionend : function(){
        if (this.lastSelected) {
          this.lastSelected = null;
        }

        // update route here if not it cripples animation
        if(this.$.pages.selected === 0 || this.$.pages.selected === 1){
          window.location.href = '#' + this.page.chapterId + '/' + this.page.id;
        }
        else{
          window.location.href = '#' + this.page.chapterId + '/' + this.page.id + '/full/' + (this.$.pages.selected - 2);
        }

      },
      previouspageChanged : function(){
        this.$.footerYo.previous = this.previouspage;
      },
      nextpageChanged : function(){
        this.$.footerYo.next = this.nextpage;
      },
      selectView : function(e) {
        var i = e.target.templateInstance.model.item;
        this.$.pages.selected = i+2;
      },
      back : function() {
        this.lastSelected = this.$.pages.selected;
        this.$.pages.selected = 1;
      }
    });
  </script>
</polymer-element>