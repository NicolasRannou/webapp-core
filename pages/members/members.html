<polymer-element name="members-element" attributes="page nextpage previouspage route narrow full color colorinit">
  <template>
    <link rel="stylesheet" href="members.css"> 
    <div id="container1" layout horizontal fit style="background-color: {{ page.style.primary.normal.color }};">

      <core-animated-pages id="pages" flex selected="0" on-core-animated-pages-transition-end="{{transitionend}}" transitions="cross-fade-all hero-transition slide-up slide-down">

      <!-- loading section -->
      <section vertical layout >

              <div class="loading" fit style="min-height:100%;" flex="" horizontal="" wrap="" center="" around-justified="" layout="" slide-down cross-fade>
                 Loading the page!
              </div>

        </section>

        <section vertical layout style="overflow:hidden">
          <div id="noscroll" fit cross-fade?="{{$.pages.selected > 0}}" slide-up?="{{lastSelected === 0 && $.pages.selected === 1}}">
            <div id="container" flex="" horizontal="" wrap="" around-justified="" layout="" cross-fade="" style="background-color: #f9f9f9;" >

              <div class="page" row style="color: {{ page.style.primary.dark.color }}; flex:1 100%">
                <div class="block grid_outer">
                <div class='padder'>
                  <span cross-fade> Members </span>
                  </div>
                </div>
                  
              </div>

              <div style="flex: 1 100%;" cross-fade>
                <div class="grid_outer" flex horizontal wrap around-justified layout cross-fade>
                  <template repeat="{{item, itemIndex in rows}}">
                    <div class="card" style="background-color:{{ page.style.primary.light.color }};"vertical center center-justified layout hero-id="item-{{itemIndex}}" hero?="{{$.pages.selected === itemIndex + 2 || lastSelected === itemIndex + 2}}" on-tap="{{selectView}}">
<!--                     <span class='picture' cross-fade>{{itemIndex}}</span>
                    <span class='label' cross-fade>{{item.gsx$name.$t}}</span> -->

                    <div flex="" auto="" vertical="" layout="" style="width:100%">
                      <div flex="" auto="" relative=""></div>
                      <div class="cat-name" horizontal center="" layout=""style="-webkit-transform-origin: 0px 0px 0px; border-radius: 0px; background-color: {{ page.style.primary.normal.color }}">
                        <div flex="">
                          <span>{{item.gsx$name.$t}}</span>
                        </div>
                      </div>
                    </div>

                  </div>
              </template>
</div>
</div>
              <footer-element cross-fade id="footerYo" narrow="{{narrow}}"></footer-element>
            </div>
            </div>
          <!-- </core-scroll-header-panel> -->
        </section>

        <template repeat="{{item, itemIndex in rows}}">
          <section vertical layout>
            <div on-tap="{{back}}" class="view" style="background-color:{{ page.style.primary.light.color }};" flex vertical center center-justified layout hero-id="item-{{itemIndex}}" hero?="{{$.pages.selected === itemIndex + 2 || $.pages.selected === 1}}"><span cross-fade>{{itemIndex}}</span></div>
          </section>
        </template>

      </core-animated-pages>

    </div>

    <google-sheets key="{{ page.key }}"  rows="{{ rows }}" published></google-sheets>

  </template>

  <script>
    Polymer('members-element', {
      rowsChanged: function(){
      if(this.rows && this.rows.length >= 1 && this.$.pages.selected === 0){
        this.lastSelected = 0;
        this.$.pages.selected = 1;
      }
    },
      routeChanged : function(){
        // not right page, exit
        if(! (this.route[0] === this.page.chapterId && this.route[1] === this.page.id )){
            return;
        }

        if(this.route.length < 3){
          // here we assume data is loaded....
          if(this.rows.length > 0){
            this.back();
          }
          else{
            this.$.pages.selected = 0;
          }
        }
        else{
          this.$.pages.selected = parseInt(this.route[3]) + 2;
        }
      },
      transitionend : function(){
        if (this.lastSelected) {
          this.lastSelected = null;
        }

        // update route here if not it cripples animation
        if(this.$.pages.selected === 0 || this.$.pages.selected === 1){
          window.location.href = '#' + this.page.chapterId + '/' + this.page.id;
        }
        else{
          window.location.href = '#' + this.page.chapterId + '/' + this.page.id + '/full/' + (this.$.pages.selected - 2);
        }

      },
      previouspageChanged : function(){
        this.$.footerYo.previous = this.previouspage;
      },
      nextpageChanged : function(){
        this.$.footerYo.next = this.nextpage;
      },
      selectView : function(e) {
        var i = e.target.templateInstance.model.itemIndex;
        this.$.pages.selected = i+2;
      },
      back : function() {
        this.lastSelected = this.$.pages.selected;
        this.$.pages.selected = 1;
      }
    });
  </script>
</polymer-element>